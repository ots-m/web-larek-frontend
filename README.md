# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, использумые в приложении

`IProduct` - описывает структуру объекта карточки товара:
- id: string; - индентификатор.
- description: string; - описание.
- image: string; - ссылка на изображение.
- title: string; - заголовок.
- category: string; - категория.
- price: number; - цена.

`IProductList` - описывает каталог карточек товаров:
- items: IProduct[]; - массив объектов товаров IProduct.
- total: number; - общее число товаров

`IAddressData` - интерфейс адреса и способа оплаты клиента:
- address: string; - адрес доставки.
- payment: TPaymentMethod; - способ оплаты.

`IContactData` - интерфейс контактных данных клиента:
- email: string; - почта.
- phone: string; - номер телефона.

`IOrder` - описывает структуру заказа:
- itemsId: string[]; - коллекция id товаров, добавленных в заказ.
- total: number; - сумма заказа.
- payment: TPaymentMethod; - способ оплаты, TPaymentMethod простой тип основанный строками 'online', 'offline'.
- email: string; - почта.
- phone: string; - номер телефона.
- address: string; - адрес доставки.

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:

- Cлой данных (Model) — отвечает за хранение и изменение данных,
- Cлой представления (View) — отвечает за отображение данных на странице,
- Презентер (Presenter) — отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\
 В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. \
Методы:

- `get` — выполняет GET запрос на переданный в параметрах endpoint и возвращает промис с объектом, которым ответил сервер.
- `post` — принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint, переданный в вызове метода. \
По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. \
Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` — подписка на событие
- `emit` — инициализация события
- `trigger` — возвращает функцию, при вызове которой инициируется требуемое в параметрах событие

#### Класс Component

Абстрактный класс с набором базового функционала для работы с отображением. \
Конструктор принимает HTMLElement, в котором будет рендериться компонент. \
Методы:

- `toggleClass` - переключает CSS класс у элемента.

- `setText` - устанавливает текст элемента.

- `setDisabled` - включает или отключает элемент.

- `setHidden` - скрывает элемент.

- `setVisible` - показывает элемент.

- `setImage` - устанавливает изображение и альтернативный текст.

- `render` - Возвращает корневой DOM-элемент.

### Cлой данных (Model)

#### Класс AppState

Описывает структуру глобального состояния приложения,\
 включающий в себя все основные данные для работы сайта.

Поля класса:
- catalog: IProduct[] - массив всех товаров.
- basket: IProduct[] - товары в корзине.
- preview: IProduct | null - товар для предпросмотра.
- order: IOrder | null - данные заказа.

Методы класс: 
- addToBasket(item: IProduct): void - добавляет товар в корзину
- removeFromBasket(id: string): void - удаляет товар из корзины
- clearBasket(): void; - очищает корзину.
- getBasketTotal(): number; - возвращает сумму товаров в корзине.
- getBasketCount(): number; - возвращает количество товаров в корзине.
- setItems(items: IProduct[]): void; - заполнить каталог товарами.
- setPreview(item: IProduct): void; - устанавливает товар для предпросмотра.
- validate(): void - проверка на валидность данных заказа.
- setOrderField(field: keyof IOrder, value: string): void - устанавливает поле заказа.

### Cлой отображения (View)

#### Класс Page

Отвечает за отображение каталога товаров на главной странице.

Поля класса:
- catalogContainer: HTMLElement; - контейнер для каталога товаров.
- basketCounter: HTMLElement; - счётчик товаров в корзине.
- basketButton: HTMLElement; - кнопка корзины. 

Методы класс: 
- setCatalog(items: IProduct[]): void; - отображает массив карточек товаров в каталог.
- setBasketCounter(count: number): void; - обновляет счётчик товаров.

#### Класс Card

Отвечает за создание универсальных карточек товара. \
В конструктор передается HTMLTemplateElement.

Методы класс: 
- renderCard(data: IProduct): HTMLElement; - создает карточку для каталога.
- renderPreview(data: IProduct): HTMLElement; - создает карточку для превью.
- renderBasket(data: IProduct): HTMLElement; - создает карточку для корзины.

#### Класс AddressForm

Отображает форму с выбором способа оплаты и адреса клиента.

Поля класса:
- form: HTMLElement; - элемент формы.
- errors: HTMLElement; - элемент ошибки.
- addressInput: HTMLElement - поле адреса.
- submitButton: HTMLElement - кнопка отправки формы.
- OnlineMethod: HTMLElement - метод оплаты 'online'.
- OfflineMethod: HTMLElement - метод оплаты 'offline'.

Методы класс:
- onInputChange(field: keyof T, value: string): void; - обработка изменения в поле формы
- setErrors(value: string): void; - отображает сообщение ошибки.
- validate(value: boolean): void; - изменяет состояние кнопки.
- clear(): void; - очистка формы.

#### Класс ContactForm

Отображает форму с контактными данными клиента.

Поля класса:
- form: HTMLElement; - элемент формы.
- errors: HTMLElement; - элемент ошибки.
- emailInput: HTMLElement - поле почты.
- phoneInput: HTMLElement - поле телефона.
- submitButton: HTMLElement - кнопка отправки формы.

Методы класс:
- onInputChange(field: keyof T, value: string): void; - обработка изменения в поле формы
- setErrors(value: string): void; - отображает сообщение ошибки.
- validate(value: boolean): void; - изменяет состояние кнопки.
- clear(): void; - очистка формы.

#### Класс Success

Отображает форму успешной покупки.

Поля класса:
- form: HTMLElement; - элемент формы.
- total: number; - сумма заказа.
- confirmButton: HTMLElement - кнопка подтверждения формы.

Методы класс:
- totalPrice(total: number): void; - отображает сообщение с суммой заказа.
- clear(): void; - очистка формы.

#### Класс BasketView

Отображает корзину.

Поля класса:
- items: HTMLElement; - контейнер товаров.
- totalItems: HTMLElement; - элемент суммы товаров.
- orderButton: HTMLElement - кнопка заказа.

Методы класс:
- validate(value: boolean): void; - изменяет состояние кнопки.

#### Класс Modal

Отвечает за создания универсального модального окна.

Поля класса:
- container: HTMLElement; - контейнер модального окна.

Методы класса: 
- open(content: HTMLElement): void; - открыть модальное окно.
- close(): void; - закрыть модальное окно.
- setContent(content: HTMLElement): void; - устанавливает контент для модального окна.
- render(): HTMLElement; - возвращает модальное окно.

## Слой Презентера (Presenter)

Реализован в файле `src/index.ts`

Presenter — это связующее звено между слоями, которое принимает пользовательские команды из View, обрабатывает их, взаимодействует с Model для работы с данными, и обновляет View соответствующей информацией или состоянием.  

В `index.ts` сначала создаются все необходимые объекты (View и Model компоненты). После этого эти объекты настраиваются, подключаются к событиям через EventEmitter, загружают данные.

## События

- `catalog:loaded` - список товаров загружен в каталог.
- `catalog:card_preview` - выбрана карточка товара.
- `basket:added` - товар добавлен в корзину.
- `basket:deleted` - товар удален из корзину.
- `basket:changed` - данные корзины были изменены.
- `order:submited` - заказ сформирован.
- `order:payment_submited` - клиент выбрал вид оплаты и адрес.
- `order:contats_submited` - клиент заполнил контактные данные.
- `order:finally` - клиент оформил заказ.

## Взаймодействия 

Пользователь взаимодействует с интерфейсом, что вызывает события в слое отображения (View). View передает эти события через методы презентера (Presenter). Presenter реагирует на пользовательские действия, вызывает методы слоя данных (Model) для обработки или получения данных. После получения данных Model возвращает их Presenter, который передает подготовленные данные обратно в слой отображения (View) для отображения пользователю. В этом сценарии взаимодействия все действия проходят по цепочке: \
V --> P --> M --> P --> V, где
- M - означает класс слоя Model,
- V - означает класс слоя View,
- P - означает метод презентера Present,
- --> означает переход выполнения приложения из одной сущности в другую.

### Основные моменты взаймодействия

- View не содержат бизнес-логики и взаимодействуют друг с другом через события (EventEmitter) или через методы Presenter.
- Model отвечает за хранение данных и их изменение, а также за работу с API.
- Presenter — связывает View и Model вместе. Presenter слушает события, обновляет Model, вызывает методы View для отображения.




