# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, использумые в приложении

`IProduct` - описывает структуру объекта карточки товара:
- id: string; - индентификатор.
- description: string; - описание.
- image: string; - ссылка на изображение.
- title: string; - заголовок.
- category: string; - категория.
- price: number | null; - цена товара, некоторые товары могут быть 'бесценны'.

`IBasketIndex` - расширяет `IProduct` для индексации товаров в корзине:
- index: number; - индекс.

`IProductList` - описывает каталог карточек товаров:
- items: IProduct[]; - массив объектов товаров IProduct.

`IAddressData` - интерфейс адреса и способа оплаты клиента:
- address: string; - адрес доставки.
- payment: TPaymentMethod; - способ оплаты.

`IContactData` - интерфейс контактных данных клиента:
- email: string; - почта.
- phone: string; - номер телефона.

`IOrder` - описывает структуру заказа:
- payment: TPaymentMethod; - способ оплаты, TPaymentMethod простой тип основанный строками 'online', 'offline'.
- email: string; - почта.
- phone: string; - номер телефона.
- address: string; - адрес доставки.

`IOrderSuccess` - описывает успешный ответ сервера при оформлении заказа
- id: string - индентификатор заказа.
- total: number - сумма заказа.

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:

- Cлой данных (Model) — отвечает за хранение и изменение данных,
- Cлой представления (View) — отвечает за отображение данных на странице,
- Презентер (Presenter) — отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\
 В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. \
Методы:

- `get` — выполняет GET запрос на переданный в параметрах endpoint и возвращает промис с объектом, которым ответил сервер.
- `post` — принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint, переданный в вызове метода. \
По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. \
Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` — подписка на событие
- `emit` — инициализация события
- `trigger` — возвращает функцию, при вызове которой инициируется требуемое в параметрах событие

#### Класс Component

Абстрактный класс с набором базового функционала для работы с отображением. \
Конструктор принимает HTMLElement, в котором будет рендериться компонент. \
Методы:

- `toggleClass` - переключает CSS класс у элемента.

- `setText` - устанавливает текст элемента.

- `setPrice` - устанавливает цену элементу.

- `setDisabled` - включает или отключает элемент.

- `setHidden` - скрывает элемент.

- `setVisible` - показывает элемент.

- `setImage` - устанавливает изображение и альтернативный текст.

- `render` - Возвращает корневой DOM-элемент.


### Cлой данных (Model)

#### Класс AppApi

Расширяет базовый Api добавляя новые методы для работы с сервером.

Методы класса: 
- getProductCatalog(): Promise\<IProductList> - получаем список товаров с сервера.
- sendOrder(order: IOrder): Promise\<IOrderSuccess> - отправляем данные заказы на сервер.

#### Класс AppState

Описывает структуру глобального состояния приложения,\
 включающий в себя все основные данные для работы сайта.

Поля класса:
- _catalog: IProduct[] - массив всех товаров.
- _basket: IProduct[] - товары в корзине.
- _order: object - данные заказа.

Методы класса: 
- addToBasket(item: IProduct): void - добавляет товар в корзину
- removeFromBasket(id: string): void - удаляет товар из корзины
- isInBasket(id: string): boolean - проверяет не добавлен ли товар в корзину.
- get basket(): IBasketIndex[] - получает список товаров в корзине.
- clearBasket(): void; - очищает корзину.
- getBasketTotal(): number; - возвращает сумму товаров в корзине.
- getBasketCount(): number; - возвращает количество товаров в корзине.
- set catalog(items: IProduct[]) - установить список товаров в каталоге.
- get catalog(): IProduct[] - получить список товаров в каталоге
- set order(data: Partial\<IOrder>) - устанавливает данные заказа, частично или полностью.
- get order() - возвращает данные заказа.

### Cлой отображения (View)

#### Класс Page

Отвечает за отображение каталога товаров на главной странице.

Поля класса:
- catalogContainer: HTMLElement; - контейнер для каталога товаров.
- basketCounter: HTMLElement; - счётчик товаров в корзине.
- basketButton: HTMLButtonElement; - кнопка корзины. 
- _wrapper: HTMLElement; - обёртка страницы.
Методы класс: 
- setCatalog(items: HTMLElement[]): void; - отображает массив карточек товаров в каталог.
- setBasketCounter(count: number): void; - обновляет счётчик товаров.
- set locked(value: boolean); устанавливает состояние блокировки интерфейса;

#### Класс Card

Отвечает за создание универсальных карточек товара. \
В конструктор передается HTMLTemplateElement.

Методы класса: 
- renderCard(data: IProduct): HTMLElement; - создает карточку для каталога.
- renderPreview(data: IProduct, isInBasket: boolean): HTMLElement; - создает карточку для превью.
- renderBasket(data: IProduct): HTMLElement; - создает карточку для корзины.

#### Класс AddressForm

Отображает форму с выбором способа оплаты и адреса клиента.

Поля класса:
- errors: HTMLElement; - элемент ошибки.
- addressInput: HTMLElement - поле адреса.
- submitButton: HTMLElement - кнопка отправки формы.
- OnlineMethod: HTMLElement - метод оплаты 'online'.
- OfflineMethod: HTMLElement - метод оплаты 'offline'.
- selectedPaymentMethod: TPaymentMethod | null - выбор типа оплаты.

Методы класса:
- selectPaymentMethod(method: TPaymentMethod): void - устанавливает классы элементов.
- isAddressFilled(): boolean - проверяет, заполнен ли адрес.
- isPaymentSelected(): boolean -  проверяет, выбран ли способ оплаты.
- checkFormValidity(): void - проверяет валидность формы.
- getFormData(): { address: string; payment: TPaymentMethod } - возвращает данные формы.
- setErrors(value: string): void; - отображает сообщение ошибки.
- validate(value: boolean): void; - изменяет состояние кнопки.
- clear(): void; - очистка формы.
- render(): HTMLElement - возвращает элемент формы для отображения на странице.

#### Класс ContactForm

Отображает форму с контактными данными клиента.

Поля класса:
- errors: HTMLElement; - элемент ошибки.
- emailInput: HTMLElement - поле почты.
- phoneInput: HTMLElement - поле телефона.
- submitButton: HTMLElement - кнопка отправки формы.

Методы класса:
- checkFormValidity(): void - проверяет валидность формы.
- onInputChange(field: keyof T): void; - обработка изменения в поле формы.
- getFormData(): { email: string; phone: string } - возвращает данные формы.
- setErrors(value: string): void; - отображает сообщение ошибки.
- validate(value: boolean): void; - изменяет состояние кнопки.
- clear(): void; - очистка формы.
- render(): HTMLElement - возвращает элемент формы для отображения на странице.

#### Класс Success

Отображает форму успешной покупки.

Поля класса:
- totalElement: HTMLElement; - элемент суммы заказа.
- confirmButton: HTMLElement - кнопка подтверждения формы.

Методы класса:
- totalPrice(total: number): void; - отображает сообщение с суммой заказа.

#### Класс BasketView

Отображает корзину.

Поля класса:
- basketContainer: HTMLElement; - контейнер товаров.
- totalElement: HTMLElement; - элемент суммы товаров.
- basketButton: HTMLButtonElement; - кнопка корзины.

Методы класса:
- renderBasket(items: HTMLElement[], total: number): void - отрисовывает корзину
- setButtonDisabled(state: boolean): void - валидация кнопки.

#### Класс Modal

Отвечает за создания универсального модального окна.

Поля класса:
- modalContent: HTMLElement; - контейнер модального окна.
-  closeButton: HTMLButtonElement; - кнока закрытия модального окна.

Методы класса: 
- open(content: HTMLElement): void; - открыть модальное окно.
- close(): void; - закрыть модальное окно.
- setContent(content: HTMLElement): void; - устанавливает контент для модального окна.

## Слой Презентера (Presenter)

Реализован в файле `src/index.ts`

Presenter — это связующее звено между слоями, которое принимает пользовательские команды из View, обрабатывает их, взаимодействует с Model для работы с данными, и обновляет View соответствующей информацией или состоянием.  

В `index.ts` сначала создаются все необходимые объекты (View и Model компоненты). После этого эти объекты настраиваются, подключаются к событиям через EventEmitter, загружают данные.

## События

- `catalog:loaded` - список товаров загружен в каталог.
- `catalog:card_preview` - выбрана или изменена карточка товара.
- `catalog:basket_open` - открыта корзина.
- `basket:added` - товар добавлен в корзину.
- `basket:deleted` - товар удален из корзину.
- `basket:changed` - данные корзины были изменены.
- `order:submited` - заказ сформирован.
- `order:payment_submited` - клиент выбрал вид оплаты и адрес.
- `order:contacts_submited` - клиент заполнил контактные данные.
- `order:finally` - клиент оформил заказ.
- `modal:open` - открытие модального окна.
- `modal:close` - закрытие модального окна.

## Взаймодействия 

Пользователь взаимодействует с интерфейсом, что вызывает события в слое отображения (View). View передает эти события через методы презентера (Presenter). Presenter реагирует на пользовательские действия, вызывает методы слоя данных (Model) для обработки или получения данных. После получения данных Model возвращает их Presenter, который передает подготовленные данные обратно в слой отображения (View) для отображения пользователю. В этом сценарии взаимодействия все действия проходят по цепочке: \
V --> P --> M --> P --> V, где
- M - означает класс слоя Model,
- V - означает класс слоя View,
- P - означает метод презентера Present,
- --> означает переход выполнения приложения из одной сущности в другую.

### Основные моменты взаймодействия

- View не содержат бизнес-логики и взаимодействуют друг с другом через события (EventEmitter) или через методы Presenter.
- Model отвечает за хранение данных и их изменение, а также за работу с API.
- Presenter — связывает View и Model вместе. Presenter слушает события, обновляет Model, вызывает методы View для отображения.




